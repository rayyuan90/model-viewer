{"version":3,"file":"model-viewer-base-spec.js","sourceRoot":"","sources":["../../src/test/model-viewer-base-spec.js"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ModelViewerElementBase, {$renderer, $scene} from '../model-viewer-base.js';\n\nimport {timePasses, until, waitForEvent} from './helpers.js';\n\nconst expect = chai.expect;\n\nsuite('ModelViewerElementBase', () => {\n  test('is not registered as a custom element by default', () => {\n    expect(customElements.get('model-viewer-base'))\n        .to.be.equal(undefined);\n  });\n\n  suite('when registered', () => {\n    let nextId = 0;\n    let tagName;\n    let ModelViewerElement;\n\n    setup(() => {\n      tagName = `model-viewer-${nextId++}`;\n      ModelViewerElement = class extends ModelViewerElementBase {\n        static get is() {\n          return tagName;\n        }\n      };\n      customElements.define(tagName, ModelViewerElement);\n    });\n\n    test('can be directly instantiated', () => {\n      const element = new ModelViewerElement();\n      expect(element).to.be.ok;\n    });\n\n    test('can be instantiated with document.createElement', () => {\n      const element = document.createElement(tagName);\n      expect(element).to.be.ok;\n    });\n\n    suite('with a valid src', () => {\n      let element;\n      setup(() => {\n        element = new ModelViewerElement();\n        document.body.appendChild(element);\n      });\n\n      teardown(() => {\n        element.remove();\n      });\n\n      test('eventually dispatches a load event', (done) => {\n        const onLoad = () => {\n          element.removeEventListener('load', onLoad);\n          done();\n        };\n\n        element.addEventListener('load', onLoad);\n        element.src = './examples/assets/Astronaut.glb';\n      });\n    });\n\n    suite('orchestrates rendering', () => {\n      let elements = [];\n\n      setup(async () => {\n        elements.push(new ModelViewerElement());\n        elements.push(new ModelViewerElement());\n        elements.push(new ModelViewerElement());\n\n        const loaded = elements.map(e => waitForEvent(e, 'load'));\n\n        for (let element of elements) {\n          element.style.height = '200vh';\n          element.style.width = '100vw';\n          element.autoRotate = true;\n          element.src = './examples/assets/cube.gltf';\n          document.body.appendChild(element);\n        }\n\n        await Promise.all(loaded);\n      });\n\n      teardown(() => {\n        elements.forEach(e => e.remove());\n      });\n\n      test.skip('only models visible in the viewport', async () => {\n        const renderer = elements[0][$renderer];\n\n        // IntersectionObserver needs to set appropriate\n        // visibility on the scene, lots of timing issues when\n        // running -- wait for the visibility flags to be flipped\n        await until(() => {\n          return elements\n              .map((element, index) => {\n                return (index === 0) === element[$scene].isVisible;\n              })\n              .reduce(((l, r) => l && r), true);\n        });\n\n        expect(elements[0][$scene].isVisible).to.be.ok;\n        expect(elements[1][$scene].isVisible).to.not.be.ok;\n        expect(elements[2][$scene].isVisible).to.not.be.ok;\n      });\n    });\n  });\n});\n"]}